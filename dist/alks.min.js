!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var e,l=require("tslib"),d=l.__importStar(require("../package.json")),h=require("buffer"),c=(l.__importDefault(require("node-fetch")),window.fetch.bind(window));!function(e){(t=e.TrustType||(e.TrustType={})).CrossAccount="Cross Account",t.InnerAccount="Inner Account",(i=e.PseudoBoolean||(e.PseudoBoolean={}))[i.True=1]="True",i[i.False=0]="False";var t=(n.prototype.create=function(e){return new n(l.__assign(l.__assign({},this.config),e))},n.prototype.getAccounts=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getAccounts",n)];case 1:return t=e.sent(),[2,Object.keys(t.accountListRole).map(function(e){return{account:e,role:t.accountListRole[e][0].role,iamKeyActive:t.accountListRole[e][0].iamKeyActive,maxKeyDuration:t.accountListRole[e][0].maxKeyDuration,skypieaAccount:t.accountListRole[e][0].skypieaAccount}})]}})})},n.prototype.getKeys=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getKeys",t)];case 1:return[2,s(e.sent(),["accessKey","secretKey","sessionToken","consoleURL"])]}})})},n.prototype.getIAMKeys=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getIAMKeys",t)];case 1:return[2,s(e.sent(),["accessKey","secretKey","sessionToken","consoleURL"])]}})})},n.prototype.getAllAWSRoleTypes=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return t=n.getDynamicValues?"allAwsRoleTypes?getDynamicValues=true":"allAwsRoleTypes",[4,this.internalFetch(t,n,"GET")];case 1:return[2,e.sent().roleTypes]}})})},n.prototype.getAWSRoleTypes=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getAWSRoleTypes",n)];case 1:return t=e.sent(),[2,JSON.parse(t.roleTypes)]}})})},n.prototype.getNonServiceAWSRoleTypes=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getNonServiceAWSRoleTypes",n)];case 1:return t=e.sent(),[2,JSON.parse(t.roleTypes)]}})})},n.prototype.createRole=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("createRole",n)];case 1:return(t=e.sent()).denyArns=t.denyArns.split(","),[2,s(t,["roleArn","denyArns","instanceProfileArn","addedRoleToInstanceProfile"])]}})})},n.prototype.createNonServiceRole=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("createNonServiceRole",n)];case 1:return(t=e.sent()).denyArns=t.denyArns.split(","),[2,s(t,["roleArn","denyArns","instanceProfileArn","addedRoleToInstanceProfile"])]}})})},n.prototype.awsAccountRoles=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("awsAccountRoles?account="+t.account,t,"GET")];case 1:return[2,e.sent().awsRoleList]}})})},n.prototype.listAWSAccountRoles=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("listAWSAccountRoles",n)];case 1:return t=e.sent(),[2,JSON.parse(t.jsonAWSRoleList).map(function(e){return e.split("/").slice(-1)[0]})]}})})},n.prototype.getAccountRole=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("getAccountRole",n)];case 1:if(!(t=e.sent()).roleExists)throw new Error("Role "+n.roleName+" does not exist in this account");return[2,t.roleARN]}})})},n.prototype.deleteRole=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("deleteRole",t)];case 1:return e.sent(),[2,!0]}})})},n.prototype.addRoleMachineIdentity=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("roleMachineIdentity",t)];case 1:return[2,s(e.sent(),["machineIdentityArn"])]}})})},n.prototype.deleteRoleMachineIdentity=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("roleMachineIdentity",t,"DELETE")];case 1:return[2,s(e.sent(),["machineIdentityArn"])]}})})},n.prototype.getUserAccess=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return t=n.accountId,[4,this.internalFetch("userAccess/"+t,n,"GET")];case 1:return[2,e.sent().users]}})})},n.prototype.getUserAccessByRole=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return t=n.accountId,[4,this.internalFetch("reports/users-by-role?accountId="+t,n,"GET")];case 1:return[2,e.sent().users]}})})},n.prototype.getUserRoleAccess=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return t=n.accountId,[4,this.internalFetch("userAccess/roles/"+t,n)];case 1:return[2,e.sent().roles]}})})},n.prototype.getAccountOwners=function(n){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return t=n.accountId,[4,this.internalFetch("userAccess/owners/"+t,n,"GET")];case 1:return[2,e.sent().accountOwners]}})})},n.prototype.createAccessKeys=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("accessKeys",t)];case 1:return[2,s(e.sent(),["iamUserArn","accessKey","secretKey","addedIAMUserToGroup"])]}})})},n.prototype.deleteIAMUser=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("IAMUser",t,"DELETE")];case 1:return e.sent(),[2,!0]}})})},n.prototype.version=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("version",t,"GET")];case 1:return[2,s(e.sent(),["version"])]}})})},n.prototype.getLoginRole=function(r){return l.__awaiter(this,void 0,void 0,function(){var t,n;return l.__generator(this,function(e){switch(e.label){case 0:return t=r.accountId,n=r.role,[4,this.internalFetch("loginRoles/id/"+t+"/"+n,r,"GET")];case 1:return[2,s(e.sent().loginRole,["account","role","iamKeyActive","maxKeyDuration"])]}})})},n.prototype.getAccessToken=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("accessToken",t)];case 1:return[2,s(e.sent(),["accessToken","expiresIn"])]}})})},n.prototype.getRefreshTokens=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("refreshTokens",t,"GET")];case 1:return[2,e.sent().refreshTokens.map(function(e){return s(e,["clientId","id","userId","value"])})]}})})},n.prototype.revoke=function(t){return l.__awaiter(this,void 0,void 0,function(){return l.__generator(this,function(e){switch(e.label){case 0:return[4,this.internalFetch("revoke",t)];case 1:return[2,"Success"==e.sent().statusMessage]}})})},n.prototype.internalFetch=function(i,c,a){return void 0===c&&(c={}),void 0===a&&(a="POST"),l.__awaiter(this,void 0,void 0,function(){var t,n,r,o,s;return l.__generator(this,function(e){switch(e.label){case 0:return t=l.__assign(l.__assign({},this.config),c),s=l.__assign({},t),n={"Content-Type":"application/json","User-Agent":"AlksJS/"+d.version},void 0!==t.accessToken?(n.Authorization="Bearer "+t.accessToken,delete s.accessToken):void 0!==t.accessKey?(n["ALKS-STS-Access-Key"]=t.accessKey,n["ALKS-STS-Secret-Key"]=t.secretKey,n["ALKS-STS-Session-Token"]=t.sessionToken,delete s.accessKey,delete s.secretKey,delete s.sessionToken):void 0!==t.userid&&(console.error("The userid and password properties are deprecated and should be replaced with an access token"),r=function(e){void 0===e&&(e="");return h.Buffer.from(e).toString("base64")}(t.userid+":"+t.password),n.Authorization="Basic "+r,delete s.userid,delete s.password),t.userAgent&&(n["User-Agent"]+=" "+t.userAgent,delete s.userAgent),[4,t.fetch(t.baseUrl+"/"+i,{method:a,headers:n,body:"GET"==a?void 0:JSON.stringify(s)})];case 1:return[4,(o=e.sent()).json().catch(function(){})];case 2:if(s=e.sent(),!o.ok)throw new u(o,s);return[2,s]}})})},n);function n(e){this.config=e}e.Alks=t;var o,u=(o=Error,l.__extends(r,o),r);function r(e,t){var n=this,r=Array.isArray(null==t?void 0:t.errors)?t.errors:[];e.statusText&&r.unshift(e.statusText);r=r.join("; ");return(n=o.call(this,r)||this).status=e.status,n.message=r,Object.assign(n,t),n}function s(n,e){return e.reduce(function(e,t){return e[t]=n[t],e},{})}e.AlksError=u;var i=t.prototype.create.call({},{fetch:c});e.create=t.prototype.create.bind(i),e.getAccounts=t.prototype.getAccounts.bind(i),e.getKeys=t.prototype.getKeys.bind(i),e.getIAMKeys=t.prototype.getIAMKeys.bind(i),e.getAllAWSRoleTypes=t.prototype.getAllAWSRoleTypes.bind(i),e.getAWSRoleTypes=t.prototype.getAWSRoleTypes.bind(i),e.getNonServiceAWSRoleTypes=t.prototype.getNonServiceAWSRoleTypes.bind(i),e.createRole=t.prototype.createRole.bind(i),e.createNonServiceRole=t.prototype.createNonServiceRole.bind(i),e.awsAccountRoles=t.prototype.awsAccountRoles.bind(i),e.listAWSAccountRoles=t.prototype.listAWSAccountRoles.bind(i),e.getAccountRole=t.prototype.getAccountRole.bind(i),e.deleteRole=t.prototype.deleteRole.bind(i),e.addRoleMachineIdentity=t.prototype.addRoleMachineIdentity.bind(i),e.deleteRoleMachineIdentity=t.prototype.deleteRoleMachineIdentity.bind(i),e.getUserAccess=t.prototype.getUserAccess.bind(i),e.getUserAccessByRole=t.prototype.getUserAccessByRole.bind(i),e.getUserRoleAccess=t.prototype.getUserRoleAccess.bind(i),e.getAccountOwners=t.prototype.getAccountOwners.bind(i),e.createAccessKeys=t.prototype.createAccessKeys.bind(i),e.deleteIAMUser=t.prototype.deleteIAMUser.bind(i),e.version=t.prototype.version.bind(i),e.getLoginRole=t.prototype.getLoginRole.bind(i),e.getAccessToken=t.prototype.getAccessToken.bind(i),e.getRefreshTokens=t.prototype.getRefreshTokens.bind(i),e.revoke=t.prototype.revoke.bind(i)}(e=e||{}),module.exports=e});
